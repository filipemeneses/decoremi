<div>
    <svg viewBox="0 0 320 547">
        <path transform={`translate(-16 ${32 + 128 + (6 * 32)})`} d="M84.20-0.39L84.20-0.39Q90.02 19.98 90.02 32.98L90.02 32.98Q90.02 43.26 82.84 49.86Q75.66 56.45 65.38 56.45L65.38 56.45Q55.68 56.45 48.50 50.73Q41.32 45.01 41.32 36.86L41.32 36.86Q41.32 34.14 42.39 31.33Q43.46 28.52 45.11 26.09Q46.75 23.67 49.37 22.21Q51.99 20.76 54.90 20.76L54.90 20.76Q58.78 20.76 61.79 22.80Q64.80 24.83 66.35 27.94Q67.90 31.04 67.90 34.53L67.90 34.53Q67.90 46.56 54.32 46.56L54.32 46.56Q57.81 51.99 65.57 51.99L65.57 51.99Q67.90 51.99 70.23 51.51Q72.56 51.02 75.37 49.57Q78.18 48.11 80.32 45.88Q82.45 43.65 83.81 39.67Q85.17 35.70 85.17 30.46L85.17 30.46Q85.17 26.38 79.73 1.16L79.73 1.16Q75.47 2.33 69.06 2.33L69.06 2.33Q50.25 2.33 36.76-11.64Q23.28-25.61 23.28-45.01L23.28-45.01Q23.28-51.80 25.51-58.78Q27.74-65.77 30.55-71.10Q33.37-76.44 38.90-83.13Q44.43-89.82 48.21-93.80Q51.99-97.78 58.78-104.57L58.78-104.57Q58.01-106.89 57.52-109.03Q57.04-111.16 56.65-113.30Q56.26-115.43 55.87-117.47Q55.48-119.50 55.19-121.54Q54.90-123.58 54.71-125.62Q54.51-127.65 54.42-129.59Q54.32-131.53 54.32-133.67L54.32-133.67Q54.32-151.13 60.72-162.86Q67.12-174.60 73.53-174.60L73.53-174.60Q75.08-174.60 76.92-173.05Q78.76-171.50 80.80-168.30Q82.84-165.09 84.49-160.83Q86.14-156.56 87.20-150.54Q88.27-144.53 88.27-137.74L88.27-137.74Q88.27-106.89 66.35-86.72L66.35-86.72L71.39-63.83Q71.78-63.83 72.17-63.92Q72.56-64.02 72.94-64.02Q73.33-64.02 73.62-64.12Q73.91-64.21 74.30-64.21Q74.69-64.21 75.08-64.21Q75.47-64.21 75.76-64.31Q76.05-64.41 76.34-64.41Q76.63-64.41 77.02-64.41L77.02-64.41Q88.85-64.41 97-54.80Q105.15-45.20 105.15-31.43L105.15-31.43Q104.95-8.54 84.20-0.39ZM82.64-144.72L82.64-144.72Q82.64-155.39 76.44-155.39L76.44-155.39Q72.94-155.39 69.74-152.48Q66.54-149.57 64.41-144.82Q62.27-140.07 61.01-134.15Q59.75-128.23 59.75-122.22L59.75-122.22Q59.75-114.07 62.27-108.06L62.27-108.06Q64.02-109.03 65.86-110.68Q67.71-112.33 69.45-114.36Q71.20-116.40 72.94-118.83Q74.69-121.25 76.05-123.87Q77.41-126.49 78.67-129.20Q79.93-131.92 80.80-134.54Q81.67-137.16 82.16-139.78Q82.64-142.40 82.64-144.72ZM96.61-24.83L96.61-24.83Q96.61-30.26 94.96-34.63Q93.31-38.99 90.31-42.00Q87.30-45.01 83.23-46.66Q79.15-48.31 74.30-48.31L74.30-48.31L83.03-4.46Q96.61-10.09 96.61-24.83ZM78.96-3.30L78.96-3.30L70.03-47.92Q66.54-47.14 63.34-44.52Q60.14-41.90 58.10-38.12Q56.07-34.34 56.07-30.65L56.07-30.65Q56.07-28.52 56.75-26.38Q57.42-24.25 58.39-22.70Q59.36-21.15 60.53-19.59Q61.69-18.04 62.95-17.07Q64.21-16.10 65.18-15.33Q66.15-14.55 66.83-14.16Q67.51-13.77 67.51-13.77L67.51-13.77L65.96-12.80Q59.56-14.55 53.84-20.56Q48.11-26.58 48.11-35.70L48.11-35.70Q48.11-41.90 51.02-47.72Q53.93-53.54 58.01-57.33Q62.08-61.11 66.54-62.66L66.54-62.66L63.05-83.42Q32.59-58.01 32.59-34.34L32.59-34.34Q32.59-20.18 43.26-10.67Q53.93-1.16 67.51-1.16L67.51-1.16Q70.81-1.16 78.96-3.30Z"/>
        <rect x="300" y={32 + 128 + (6 * 32) - 128} width="3" height="130"/>
        <rect x="309" y={32 + 128 + (6 * 32) - 128} width="13" height="130"/>
        <path transform={`translate(160 ${$notePosition})`} d="M32.14-31.16L32.14-31.16Q43.46-31.16 51.33-26.81Q59.20-22.47 59.20-14.43L59.20-14.43Q59.20-6.72 51.50-2.54Q43.79 1.64 32.96 1.64L32.96 1.64Q21.65 1.64 13.94-2.62Q6.23-6.89 6.23-15.25L6.23-15.25Q6.23-21.16 11.07-24.93Q15.91-28.70 21.32-29.93Q26.73-31.16 32.14-31.16ZM23.29-19.52L23.29-19.52Q23.29-12.63 26.40-7.38Q29.52-2.13 34.44-2.13L34.44-2.13Q41.98-2.13 41.98-10.33L41.98-10.33Q41.98-16.89 38.95-22.06Q35.92-27.22 30.67-27.22L30.67-27.22Q23.29-27.22 23.29-19.52Z"/>
        {#each Array(highNotes) as _, index}
            <rect x="160" y={32 + (32 * 5) - (index * 32)} width="60" height="2" in:fly="{{ y: 32 + (32 * 5) - (index * 32), duration: 200 }}" out:fly="{{ y: 32 + (32 * 5), duration: 200 }}"/>
        {/each}
        {#each Array(5) as _, index}
            <rect x="0" y={32 + (6 + index) * 32} width="320" height="2"/>
        {/each}
        {#each Array(lowNotes) as _, index}
            <rect x="160" y={32 + (6 + 5 + index) * 32} width="60" height="2" in:fly="{{ y: 32 + (6 + 5 + index) * 32, duration: 200 }}" out:fly={{ y: 32 + (6 + 5) * 32, duration: 200 }}/>
        {/each}
    </svg>
    <TonePlayer note={note}/>
</div>

<script>
import { fly } from 'svelte/transition'
import { tweened } from 'svelte/motion'
import { cubicOut } from 'svelte/easing'
import TonePlayer from '@/TonePlayer.svelte'

export let note = {}

const notePosition = tweened(0, {
  duration: 280,
  easing: cubicOut
})

$: noteIndex = (note && note.index) || 0
$: tone = note && note.frequency
$: notePosition.set(64 + noteIndex * 16)
$: highNotes = noteIndex < 12 ? (5 - Math.floor(noteIndex / 2)) : 0
$: lowNotes = noteIndex > 19 ? Math.floor((noteIndex - 19) / 2) : 0
</script>

<style>
div {
    display: flex;
    justify-content: center;
    align-items: center;
}
svg {
    width: 100%;
    height: calc(100vh - 144px);
    fill: var(--color-black);
}
</style>